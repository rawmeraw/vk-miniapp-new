# Настройка VK Donut для ограничения доступа

## Требования

1. VK Donut должен быть включен в настройках сообщества
2. ID группы: `222461642`
3. Токен VK API с правами `donut`

## Получение токена

### Вариант 1: Токен группы (рекомендуется)

1. Перейдите в настройки сообщества: https://vk.com/club222461642
2. Настройки → Работа с API → Создать ключ
3. Выберите права: `donut` (проверка подписчиков)
4. Скопируйте полученный токен

### Вариант 2: Токен приложения

1. Перейдите в [VK для разработчиков](https://vk.com/dev)
2. Откройте приложение (ID: 54335646)
3. Получите токен с правами `donut`

## Настройка на сервере

### 1. Добавьте токен в переменные окружения

```bash
export VK_DONUT_TOKEN="ваш_токен_здесь"
```

### 2. Или добавьте в settings.py

```python
VK_DONUT_TOKEN = os.getenv('VK_DONUT_TOKEN', 'ваш_токен_здесь')
```

### 3. Проверьте настройки

Убедитесь, что в `zhivoe/settings.py` есть:

```python
VK_GROUP_ID = '222461642'
VK_API_VERSION = '5.199'
VK_DONUT_TOKEN = os.getenv('VK_DONUT_TOKEN', '')
```

## Тестирование

1. Откройте приложение в VK
2. Если вы не подписчик - должен появиться paywall
3. Если вы подписчик или админ - приложение должно загрузиться

## Проверка через API

Можно проверить работу endpoints напрямую:

```bash
# Проверка дона
curl "https://permlive.ru/api/vk/check-don/?user_id=ВАШ_USER_ID&group_id=222461642"

# Проверка админа
curl "https://permlive.ru/api/vk/check-admin/?user_id=ВАШ_USER_ID&group_id=222461642"
```

## Решение проблем

### Ошибка "VK Donut токен не настроен"

- Убедитесь, что переменная `VK_DONUT_TOKEN` установлена
- Перезапустите сервер после добавления токена

### Ошибка "Ошибка при обращении к VK API"

- Проверьте, что токен действителен
- Убедитесь, что токен имеет права `donut`
- Проверьте, что ID группы правильный

### Paywall показывается для подписчиков

- Проверьте, что VK Donut включен в настройках сообщества
- Убедитесь, что токен имеет права `donut`
- Проверьте логи сервера на наличие ошибок API

