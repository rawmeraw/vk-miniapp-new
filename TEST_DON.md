# Тестирование проверки дона

## Шаг 1: Настройка токена

Установите переменную окружения с токеном VK API:

```bash
export VK_DONUT_TOKEN="ваш_токен_с_правами_donut"
```

## Шаг 2: Тестирование через скрипт

Запустите тестовый скрипт:

```bash
cd /Users/rawmeraw/Dev/My\ Projects/permlive
python3 test_don_check.py
```

Скрипт проверит:
- ✅ Статус дона для user_id=660627584
- ✅ Статус администратора
- ✅ Итоговый доступ

## Шаг 3: Тестирование через API endpoint

После настройки токена и запуска сервера, проверьте через браузер или curl:

```bash
# Проверка дона
curl "http://localhost:8000/api/vk/check-don/?user_id=660627584&group_id=222461642"

# Или через браузер
http://localhost:8000/api/vk/check-don/?user_id=660627584&group_id=222461642
```

Ожидаемый ответ (если вы донатер):
```json
{
  "is_don": true,
  "is_admin": false,
  "is_member": true,
  "user_id": 660627584,
  "group_id": 222461642
}
```

## Шаг 4: Тестирование в приложении

1. Откройте VK Mini App
2. Приложение должно проверить ваш статус
3. Если вы донатер - приложение должно загрузиться
4. Если нет - должен появиться paywall с ссылкой на подписку

## Проверка ссылки на подписку

Ссылка на подписку в paywall:
```
https://vk.com/zhivoe_perm?w=donut_payment-222461642&levelId=2635
```

## Отладка

Если что-то не работает:

1. Проверьте логи сервера - там должны быть сообщения:
   - `[VK Donut Check] user_id=660627584, is_don=True/False`
   - `[VK Admin Check] user_id=660627584, managers=[...], is_admin=True/False`

2. Проверьте, что токен правильный и имеет права `donut`

3. Проверьте, что VK Donut включен в настройках сообщества

